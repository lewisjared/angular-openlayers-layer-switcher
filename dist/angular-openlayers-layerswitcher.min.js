angular.module("openlayers-layerswitcher",["openlayers-directive"]).directive("layerSwitcher",["olControlLayerSwitcher",function(e){return{restrict:"E",require:"^openlayers",link:function(t,r,r,n){var o=new e,i=n.getOpenlayersScope();i.getMap().then(function(e){t.$on("$destroy",function(){e.removeControl(o)}),e.addControl(o)})}}}]),angular.module("openlayers-layerswitcher").factory("olControlLayerSwitcher",function(){var e="title";return ol.control.LayerSwitcher=function(e){var t=e||{},r=t.tipLabel?t.tipLabel:"Legend";this.mapListeners=[],this.hiddenClassName="ol-unselectable ol-control layer-switcher",this.shownClassName=this.hiddenClassName+" shown";var n=document.createElement("div");n.className=this.hiddenClassName;var o=document.createElement("button");o.setAttribute("title",r),n.appendChild(o),this.panel=document.createElement("div"),this.panel.className="panel",n.appendChild(this.panel);var i=this;n.onmouseover=function(e){i.showPanel()},o.onclick=function(e){i.showPanel()},n.onmouseout=function(e){e=e||window.event,n.contains(e.toElement)||i.hidePanel()},ol.control.Control.call(this,{element:n,target:t.target})},ol.inherits(ol.control.LayerSwitcher,ol.control.Control),ol.control.LayerSwitcher.prototype.showPanel=function(){this.element.className!=this.shownClassName&&(this.element.className=this.shownClassName,this.renderPanel())},ol.control.LayerSwitcher.prototype.hidePanel=function(){this.element.className!=this.hiddenClassName&&(this.element.className=this.hiddenClassName)},ol.control.LayerSwitcher.prototype.renderPanel=function(){for(this.ensureTopVisibleBaseLayerShown_();this.panel.firstChild;)this.panel.removeChild(this.panel.firstChild);var e=document.createElement("ul");this.panel.appendChild(e),this.renderLayers_(this.getMap(),e)},ol.control.LayerSwitcher.prototype.setMap=function(e){for(var t=0;t<this.mapListeners.length;t++)this.getMap().unByKey(this.mapListeners[t]);if(this.mapListeners.length=0,ol.control.Control.prototype.setMap.call(this,e),e){var r=this;this.mapListeners.push(e.on("pointerdown",function(){r.hidePanel()})),this.renderPanel()}},ol.control.LayerSwitcher.prototype.ensureTopVisibleBaseLayerShown_=function(){var e;ol.control.LayerSwitcher.forEachRecursive(this.getMap(),function(t,r,n){"base"===t.get("type")&&t.getVisible()&&(e=t)}),e&&this.setVisible_(e,!0)},ol.control.LayerSwitcher.prototype.setVisible_=function(e,t){var r=this.getMap();e.setVisible(t),t&&"base"===e.get("type")&&ol.control.LayerSwitcher.forEachRecursive(r,function(t,r,n){t!=e&&"base"===t.get("type")&&t.setVisible(!1)})},ol.control.LayerSwitcher.prototype.renderLayer_=function(t,r){var n=this,o=document.createElement("li"),i=t.get(e),a=t.get(e).replace(" ","-")+"_"+r,l=document.createElement("label");if(t.getLayers){o.className="group",l.innerHTML=i,o.appendChild(l);var s=document.createElement("ul");o.appendChild(s),this.renderLayers_(t,s)}else{var c=document.createElement("input");"base"===t.get("type")?(c.type="radio",c.name="base"):c.type="checkbox",c.id=a,c.checked=t.get("visible"),c.onchange=function(e){n.setVisible_(t,e.target.checked)},o.appendChild(c),l.htmlFor=a,l.innerHTML=i,o.appendChild(l)}return o},ol.control.LayerSwitcher.prototype.renderLayers_=function(t,r){for(var n,o=t.getLayers().getArray().slice().reverse(),i=0;i<o.length;i++)n=o[i],n.get(e)&&r.appendChild(this.renderLayer_(n,i))},ol.control.LayerSwitcher.forEachRecursive=function(e,t){e.getLayers().forEach(function(e,r,n){t(e,r,n),e.getLayers&&ol.control.LayerSwitcher.forEachRecursive(e,t)})},ol.control.LayerSwitcher});